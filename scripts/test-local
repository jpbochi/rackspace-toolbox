#!/usr/bin/env sh
set -eu

IMAGE_CODE=$(docker build -q -f toolbox/Dockerfile ./toolbox/ -t rackspace-toolbox-test-local:latest)
IMAGE_TEST=$(docker build -q -f toolbox/Dockerfile.tests ./toolbox/)
CMD=${1:-"bats ./tests $@"}

./scripts/install-drun
./drun \
  -v "$HOME/.ssh:$(pwd)/.ssh:ro" \
  -v "$HOME/.aws:$(pwd)/.aws:ro" \
  -E '^AWS_|^USER$' \
  "$IMAGE_TEST" $CMD
